<!-- OEE Drill Through Work Done by Lead by: Zach & Lauren | Edited by: Colton-->
<!DOCTYPE html>
<html lang="en"> <!-- required to use D3-->
<html>
<head>
<meta charset="utf-8"> <!-- required to use D3-->

  <title>Line Manager</title>

<!--bootstrap stylesheet -->
<link rel="stylesheet" href="../styles/bootstrap.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link rel="stylesheet" href="../fonts/fonts.css">

<!--Zach's Stylesheet-->
<link rel="stylesheet" href="../styles/manufacturing.css">
<link rel="stylesheet" href="../styles/mobile_styles.css">

<!-- Hover effects -->
<link rel="stylesheet" href="../Hover-master/css/hover-min.css">

<!--D3/bootstrap/jquery scripts-->


<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/select2/3.5.2/select2.min.css">

<script src="../js/jquery.min.js"></script>
<script src="../js/bootstrap.min.js"></script> <!-- this version of bootstrap is essential to getting the page to run-->

<!-- cloudflare links to navbar icons-->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="../styles/faa.css">

<!--Plotly.js source file-->
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<!-- load d3 library-->

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3.min.js"></script>

<!-- datatables (controls tables-->
<!-- datatables css/js-->
<!-- each link/script controls a different function for datatables-->
 <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.15/css/dataTables.bootstrap.min.css">
 <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.3.1/css/buttons.bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.1.1/css/responsive.bootstrap.min.css">


 <!-- needed for datatables-->
 <script type="text/javascript" charset="utf-8" src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
 <script type="text/javascript" charset="utf-8" src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap.min.js"></script>

 <!-- needed for buttons (ALL)-->
 <script type="text/javascript" charset="utf-8" src="https://cdn.datatables.net/buttons/1.3.1/js/dataTables.buttons.min.js"></script>

  <script type="text/javascript" charset="utf-8" src="https://cdn.datatables.net/buttons/1.3.1/js/buttons.bootstrap.min.js"></script>

 <script type="text/javascript" charset="utf-8" src="https://cdn.datatables.net/buttons/1.3.1/js/buttons.flash.min.js"></script>

 <!-- needed for PDF/excel/csv Buttons-->
 <script type="text/javascript" charset="utf-8" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
 <script type="text/javascript" charset="utf-8" src="https:cdn.rawgit.com/bpampuch/pdfmake/0.1.27/build/pdfmake.min.js"></script>

 <!-- needed for print functionality-->
 <script type="text/javascript" charset="utf-8" src="https://cdn.rawgit.com/bpampuch/pdfmake/0.1.27/build/vfs_fonts.js"></script>

 <!-- needed for print functionality-->
 <script type="text/javascript" charset="utf-8" src="https://cdn.datatables.net/buttons/1.3.1/js/buttons.html5.min.js"></script>

 <!-- datatables print button-->
 <script type="text/javascript" charset="utf-8" src="https://cdn.datatables.net/buttons/1.3.1/js/buttons.print.min.js"></script>
 <!-- column visibility button-->
 <script type="text/javascript" charset="utf-8" src="https://cdn.datatables.net/buttons/1.3.1/js/buttons.colVis.min.js"></script>

 <script type="text/javascript" charset="utf-8" src="https://cdn.datatables.net/responsive/2.1.1/js/dataTables.responsive.min.js"></script>

<!-- end datables scripts-->

<script src='../js/lineModel.js'></script>


<style type="text/css">
/*inline style to control Line Manager page width/height*/
  #main-manager {
    padding-top: 90px;
    padding-bottom: 0px;
  padding-left: 0px;
  margin: 0px;
  overflow: none;
  overflow-x: hidden;


  }

  .kpi-manager {
    height: 175px;
  }

/* next 2 style tags are specifically to style bar/line chart*/
  #chartdiv {
  width: 100%;
  height: 280px;
}
/* TURN OFF AMCHARTS WATERMARK*/
    .amcharts-chart-div a {display:none !important;}

    a:link visited {
    color: black !important;
}


div.dataTables_wrapper div.dataTables_filter label{


}

.dataTables_filter input { width: 10px; }



</style>

</head>

<body>

<!--controls header at top of page-->
<!--FOR LATER: add pull left/right visibile sm-md-lg-->
<header>
  <nav id="header-nav" class="navbar navbar-default">
    <div class="container-fluid container-custom">
          <div class="navbar-header">
            <a href="index.html" class="pull-left">
          <div class="watson">
            <img class="watson-img" src="watson.png" style="width:80px;">
          </div><!-- end watson-logo -->
        </a>


      <div class="navbar-brand">
        <h1>Plant Manager</h1>
      </div>


      <!-- controls mobile nav bar-->
        <button id="navbarToggle" type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#collapsable-nav" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button> <!-- end mobile nav bar-->
      </div><!-- end bee-header (IBM logo) -->


      <!--contains links that will go into mobile navbar-->
      <div id="collapsable-nav" class="collapse navbar-collapse">
              <ul id="nav-list" class="nav navbar-nav navbar-right">

                <li id="navTest2Button">
                    <a href="Line_Operator.html" class="hvr-underline-reveal">
                      <span></span> <br class="hidden-xs">Line Operator</a>
                </li>

              </ul><!-- end nav list-->
            </div> <!-- end collapsable-nav-->


    </div> <!-- end container-->
  </nav> <!-- end header nav (controls entire navbar)-->
</header> <!-- end header -->



<!-- Body starts here-->
 <!-- page content -->
 <div id="main-manager"> <!-- set to 100%. allows the rest of page to scale evenly, fixes sidebar on lefthand side-->
<!-- CONTAINER HOLDS ALL ELEMENTS IN THIS PAGE -->
<div class="container-fluid container-custom">
  <!-- top tiles -->
<div class="row-fluid">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"> <!-- BEGIN KEY KPIS -->
    <!-- BEGIN STATION 1 KPIS-->
    <div id="carousel-example-generic" class="carousel slide" data-ride="carousel" >
            <div class="col-lg-4 col-sm-12">
              <div class="panel panel-custom ">
                <div class="carousel-inner" role="listbox">
                  <div class="item active">
                  <div class="panel-heading metric-heading"><a href="OEE.html" class="hvr-underline-reveal">OEE</a></div>
                          <div class="panel-body">
                            <div class="count count_orange">72%</div>
                            <div class="count_bottom">
                                <i class="red">18% </i> Less than Last Week
                                </div>
                          </div><!--Close Body-->
              </div><!--Close Custom-->
              <div class="item">
              <div class="panel-heading metric-heading"><a href="order_count.html" class="hvr-underline-reveal">OEE</a></div>
                      <div class="panel-body">
                        <div class="count count_orange">72%</div>
                        <div class="count_bottom">
                            <i class="green">2% </i> More than yesterday
                            </div>
                      </div><!--Close Body-->
          </div>
        </div>  </div><!--Close Custom-->
      </div>
            </div>     <script>
  $('.carousel').carousel({
  interval: 4000
  })
  </script><!-- end STATION 2 KPIS --> <!-- END  STATION 1 KPIS-->



          <!-- BEGIN STATION 1 KPIS-->
          <!-- STATION 2 KPIS-->
          <div id="carousel-example-generic" class="carousel slide" data-ride="carousel" >
          <div class="col-lg-4 col-sm-12">
              <div class="panel panel-custom">
                <div class="carousel-inner" role="listbox">
                  <div class="item active">
                  <div class="panel-heading metric-heading">
                           <a href="downtime.html" class="hvr-underline-reveal">Downtime Average</a>
                      </div>
                          <div class="panel-body">
                            <div class="count count_green">45 min</div>
                            <div class="count_bottom">
                                <i class="green"> 75 min</i> Less than Last Week
                                </div>
                          </div> <!--Close Body-->
            </div>
            <div class="item">
            <div class="panel-heading metric-heading"><a href="order_count.html" class="hvr-underline-reveal">Downtime Average</a></div>
                    <div class="panel-body">
                      <div class="count count_green">45 min</div>
                      <div class="count_bottom">
                          <i class="red">10 min</i> Less than yesterday
                          </div>
                    </div><!--Close Body-->
        </div>
      </div>  </div><!--Close Custom-->
    </div>
          </div>     <script>
$('.carousel').carousel({
interval: 4000
})
</script><!-- end STATION 2 KPIS -->



          <div id="carousel-example-generic" class="carousel slide" data-ride="carousel" >
          <!-- STATION 3 KPIS -->
          <div class="col-lg-4 col-sm-12">
              <div class="panel panel-custom">
                <div class="carousel-inner" role="listbox">
                  <div class="item active">
                  <div class="panel-heading metric-heading"><a href="order_count.html" class="hvr-underline-reveal">Order Count AvT</a></div>
                          <div class="panel-body">
                            <div class="count count_green">93/109</div>
                            <div class="count_bottom">
                                <i class="red">4% </i> Less than Last Week
                                </div>
                          </div><!--Close Body-->
              </div><!--Close  PANEL Custom STATION 3-->
              <div class="item">
              <div class="panel-heading metric-heading"><a href="order_count.html" class="hvr-underline-reveal">Case Count AvT</a></div>
                          <div class="panel-body">
                          <div class="count count_green">7268/10160</div>
                          <div class="count_bottom">
                              <i class="green">1% </i> More than Last Week
                              </div>
                          </div><!-- end panel body UTIL RATE-->
              </div>
          </div> <!-- END STATION 3-->
</div></div></div>            <script>
$('.carousel').carousel({
interval: 4000
})
</script>


    </div> <!-- END KEY KPIS CLASS -->

</div><!-- END ROW KPIS-->
</div> <!-- end container KPIS-->


<div class="container-fluid container-custom">
  <!-- top tiles -->
<div class="row-fluid">


    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">

    <!-- BEGIN LINE MAP-->

      <div class="col-lg-8 col-sm-12">
        <div style="height: 510px;" class="panel-custom">
            <div class="panel-heading metric-heading">
              Line Map

            </div>
                    <div class="panel-body">
                      <canvas id='canvas' width='900' height="500"></canvas>



                        <script>

                          (function() {

                              var canvas = document.getElementById('canvas');
                              var context = canvas.getContext('2d');
                              //var canvasOffset = $("#canvas").offset();
                              var offset = canvas.getBoundingClientRect();

                              var offsetX = offset.left;
                              var offsetY = offset.top;

                              var drawLines = function (ctx, canvas, offsetX, offsetY) {

                                //
                                var rect = (function () {

                                    // constructor
                                    function rect(id, x, y, width, height, fill, stroke, strokewidth) {
                                        this.x = x;
                                        this.y = y;
                                        this.id = id;
                                        this.width = width;
                                        this.height = height;
                                        this.fill = fill || "#AAAAAA";
                                        this.stroke = stroke || "#111111 ";
                                        this.strokewidth = strokewidth || 2;
                                        this.redraw(this.x, this.y);
                                        return (this);
                                    }
                                    rect.prototype.redraw = function (x, y) {
                                        this.x = x || this.x;
                                        this.y = y || this.y;
                                        this.draw(this.stroke);
                                        return (this);
                                    }
                                    //
                                    rect.prototype.highlight = function (x, y) {
                                        this.x = x || this.x;
                                        this.y = y || this.y;
                                        this.draw("#FF851B");
                                        return (this);
                                    }
                                    //
                                    rect.prototype.draw = function (stroke) {
                                        ctx.save();
                                        ctx.beginPath();
                                        ctx.fillStyle = this.fill;
                                        ctx.strokeStyle = stroke;
                                        ctx.lineWidth = this.strokewidth;
                                        ctx.rect(this.x, this.y, this.width, this.height);
                                        ctx.stroke();
                                        ctx.fill();
                                        ctx.restore();
                                    }
                                    //
                                    rect.prototype.isPointInside = function (x, y) {
                                        return (x >= this.x && x <= this.x + this.width && y >= this.y && y <= this.y + this.height);
                                    }

                                    return rect;
                                })();

                                function handleMouseDown(e) {
                                    e.preventDefault();

                                    var rectOffset = canvas.getBoundingClientRect();

                                    var pos = getMousePos(canvas, e);
                                    var mouseX = pos.x;
                                    var mouseY = pos.y;


                                    // Put your mousedown stuff here
                                    var clicked = "";
                                    for (var i = 0; i < rects.length; i++) {

                                        if (rects[i].isPointInside(mouseX, mouseY)) {
                                            $('Line_Operator.html').modal('show');
                                        }
                                    }
                                }

                                //
                                function handleMouseMove(e) {

                                    var pos = getMousePos(canvas, e);
                                    var mouseX = pos.x;
                                    var mouseY = pos.y;


                                    // Put your mousemove stuff here
                                    ctx.clearRect(-50, -50, canvas.width, canvas.height);
                                    for (var i = 0; i < rects.length; i++) {
                                        if (rects[i].isPointInside(mouseX, mouseY)) {
                                            rects[i].highlight();
                                            if(rects[i].id !== 'Line') {
                                              ctx.save();
                                              ctx.font = "20px -apple-system,  'avenir next', avenir, roboto, noto, ubuntu, 'helvetica neue', helvetica, arial, sans-serif";
                                              //ctx.fillStyle = 'red';
                                              ctx.fillText(rects[i].id, mouseX, mouseY);
                                              ctx.restore();
                                            }

                                        } else {
                                            rects[i].redraw();
                                        }
                                    }
                                }

                                function getMousePos(canvas, evt) {
                                    var rect = canvas.getBoundingClientRect();
                                    return {
                                      x: evt.clientX - rect.left - 25,
                                      y: evt.clientY - rect.top - 25
                                    };
                                }


                                //
                                var rects = [];
                                //

                                ctx.translate(25,25);

                                //Line 1
                                rects.push(new rect("Line", 25, 0, 5, 400, "black", "black", 5));
                                rects.push(new rect("Depelletizer", 0, 0, 50, 25, "gray", "black", 5));
                                rects.push(new rect("Labeler", 25, 40, 25, 35, "gray", "black", 5));
                                rects.push(new rect("Caser", 12, 100, 25, 35, 'gray', 'black', 5));
                                rects.push(new rect("Shrinkwrapper", 12, 175, 25, 35, 'gray', 'black', 5));
                                rects.push(new rect("Pelletizer", 12, 250, 25, 35, 'gray', 'black', 5));
                                rects.push(new rect("Wrapper", 12, 390, 25, 35, 'gray', 'black', 5));

                                //Line 2
                                rects.push(new rect("Line", 125, 0, 5, 400, "black", "black", 5));
                                rects.push(new rect("Depelletizer", 100, 0, 50, 25, "gray", "black", 5));
                                rects.push(new rect("Labeler", 125, 40, 25, 35, "gray", "black", 5));
                                rects.push(new rect("Caser", 112, 100, 25, 35, 'gray', 'black', 5));
                                rects.push(new rect("Shrinkwrapper", 112, 175, 25, 35, 'gray', 'black', 5));
                                rects.push(new rect("Pelletizer", 112, 250, 25, 35, 'gray', 'black', 5));
                                rects.push(new rect("Wrapper", 112, 390, 25, 35, 'gray', 'black', 5));

                                //Line 3
                                rects.push(new rect("Line", 225, 0, 5, 400, "black", "black", 5));
                                rects.push(new rect("Depelletizer", 200, 0, 50, 25, "gray", "black", 5));
                                rects.push(new rect("Labeler", 225, 40, 25, 35, "red", "black", 5));
                                rects.push(new rect("Caser", 212, 100, 25, 35, 'gray', 'black', 5));
                                rects.push(new rect("Shrinkwrapper", 212, 175, 25, 35, 'gray', 'black', 5));
                                rects.push(new rect("Pelletizer", 212, 250, 25, 35, 'gray', 'black', 5));
                                rects.push(new rect("Wrapper", 212, 390, 25, 35, 'gray', 'black', 5));

                                //Line 4 - change color of each box/line  changed position, height,width size, etc.

                                //position left/right, top/bottom, width, length
                                rects.push(new rect("Line", 425, 20, 5, 400, "#DDDDDD", "#111111", 4));
                                rects.push(new rect("Depelletizer", 400, 0, 50, 25, "#DDDDDD", "#111111", 4));
                                rects.push(new rect("Labeler", 415, 40, 25, 35, "#DDDDDD", "#111111", 4));
                                rects.push(new rect("Caser", 415, 100, 25, 35, '#DDDDDD', '#111111', 4));
                                rects.push(new rect("Shrinkwrapper", 415, 175, 25, 35, '#DDDDDD', '#111111', 4));
                                rects.push(new rect("Pelletizer", 415, 250, 25, 35, '#DDDDDD', '#111111', 4));//this one was yellow
                                rects.push(new rect("Wrapper", 415, 390, 25, 35, '#DDDDDD', '#111111', 4));

                                $("#canvas").click(handleMouseDown);
                                $("#canvas").mousemove(handleMouseMove);

                              };

                              drawLines(context, canvas, offsetX, offsetY);

                          }());
                        </script>
                    </div> <!--Panel Body End-->

                </div><!--Close Panel Body-->
      </div> <!-- end panel custom-->

<!-- END LINE MAP-->


<!-- BEGIN ALERTS TABLE-->

      <div class="col-lg-4 col-sm-12"> <!-- Alerts -->
        <div style="height: 510px;" class='panel-custom'>
          <div class ='panel-heading metric-heading'>
            Alerts
          </div>
          <div class='panel-body'>

            <table id="alert-table" class="table table-bordered table-hover" cellspacing="0" width="100%">

              <thead>
              <tr>
                <th> Date </th>
                <th> Part </th>
                <th> Reason </th>
                <th> Duration (h:m:s) </th>
              </tr>
              </thead>
              <tbody>

                <tr>
                  <td> 10-11-17 </td>
                  <td> Line #1: Caser </td>
                  <td> Load Guide Jam </td>
                  <td> 0:0:01 </td>
                </tr>

                <tr>
                  <td> 10-10-17 </td>
                  <td> Line #1: Caser </td>
                  <td> Main PB Emergency Stop </td>
                  <td> 0:0:37 </td>
                </tr>

                <tr>
                  <td> 10-10-17 </td>
                  <td> Line #1: Shrink Wrapper </td>
                  <td> Guard Door 1 Open </td>
                  <td> 0:0:35 </td>
                </tr>


                <tr>
                  <td> 10-9-17 </td>
                  <td> Line #1: Caser </td>
                  <td> Load Lift Servo Faulted </td>
                  <td> 0:0:02 </td>
                </tr>

                <tr>
                  <td> 10-6-17 </td>
                  <td> Line #1: Caser</td>
                  <td> Guard Door 5 Open</td>
                  <td> 0:0:75 </td>
                </tr>

              </tbody>

            </table> <!-- end alerts table-->

            <script>
                $(document).ready(function() {
                   $('#alert-table').DataTable({'lengthMenu':[[5, 10, -1], [5, 10, "All"]

                    ],

                     //scrollY: "300px" //turn on vertical scrolling

                  });
                });
            </script>
          </div> <!-- end panel body alerts-->
        </div> <!-- end panel custom alerts-->
      </div> <!-- end col sz for alerts-->

<!-- END ALERTS-->


</div><!-- end Column 12 -->


</div><!-- end Row Fluid-->



  </div><!-- end Container Fluid-->
</div> <!-- end MAIN-->



</body>
</html>
